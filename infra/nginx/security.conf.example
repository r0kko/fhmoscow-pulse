## Hardened security defaults for Pulse nginx sites.
## Include this file inside each server block (e.g., `include /etc/nginx/conf.d/security.conf;`).

# Restrict direct access to Prometheus metrics from the public Internet.
location /metrics {
  deny all;
}

# Baseline transport and clickjacking protections.
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options "DENY" always;
add_header X-Content-Type-Options "nosniff" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Cross-Origin-Opener-Policy "same-origin" always;
add_header Cross-Origin-Resource-Policy "same-origin" always;
add_header X-Permitted-Cross-Domain-Policies "none" always;
add_header X-DNS-Prefetch-Control "off" always;
add_header Permissions-Policy "accelerometer=(), autoplay=(), camera=(), display-capture=(), document-domain=(), encrypted-media=(), fullscreen=(self), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), midi=(), payment=(), usb=()" always;
add_header X-Robots-Tag "none" always;
proxy_hide_header X-Powered-By;
proxy_hide_header Server;

# For deployments where a CDN already injects the headers above, duplication is
# harmless and ensures coverage if the edge tier ever falls back to defaults.
# Uncomment below to fine-tune CSP for static assets served directly by nginx.
# add_header Content-Security-Policy "default-src 'self'; frame-ancestors 'none';" always;

# Optionally tighten Swagger UI exposure if the upstream defaults are too permissive.
# location /api-docs {
#   allow 127.0.0.1;
#   allow ::1;
#   allow 10.0.0.0/8;
#   allow 172.16.0.0/12;
#   allow 192.168.0.0/16;
#   deny all;
# }
