{
  "__inputs": [],
  "__requires": [],
  "title": "Pulse App Overview",
  "uid": "pulse-app-overview",
  "version": 1,
  "schemaVersion": 38,
  "tags": ["pulse", "app"],
  "time": {"from": "now-6h", "to": "now"},
  "timepicker": {"refresh_intervals": ["5s","10s","30s","1m","5m"]},
  "refresh": "30s",
  "panels": [
    {
      "type": "stat",
      "title": "Job runs (success)",
      "gridPos": {"x": 0, "y": 0, "w": 8, "h": 4},
      "targets": [
        {"expr": "sum(increase(job_runs_total{status=\"success\"}[15m]))", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ]
    },
    {
      "type": "stat",
      "title": "Job runs (errors)",
      "gridPos": {"x": 8, "y": 0, "w": 8, "h": 4},
      "targets": [
        {"expr": "sum(increase(job_runs_total{status=\"error\"}[15m]))", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ]
    },
    {
      "type": "graph", "title": "Job duration (p95 sec)",
      "gridPos": {"x": 16, "y": 0, "w": 8, "h": 8},
      "targets": [
        {"expr": "histogram_quantile(0.95, sum by (le, job) (rate(job_duration_seconds_bucket[5m])))", "legendFormat": "{{job}}", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ]
    },
    {
      "type": "table", "title": "Last job success (per job)",
      "gridPos": {"x": 0, "y": 4, "w": 16, "h": 8},
      "targets": [
        {"expr": "job_last_success_timestamp_seconds", "legendFormat": "{{job}}", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ],
      "transformations": [ {"id": "labelsToFields", "options": {"mode": "rows"}} ]
    },
    {
      "type": "stat", "title": "Event loop lag (sec)",
      "gridPos": {"x": 0, "y": 12, "w": 8, "h": 4},
      "targets": [
        {"expr": "avg(nodejs_eventloop_lag_seconds)", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ]
    },
    {
      "type": "stat", "title": "Process RSS (MB)",
      "gridPos": {"x": 8, "y": 12, "w": 8, "h": 4},
      "targets": [
        {"expr": "avg(process_resident_memory_bytes) / 1024 / 1024", "datasource": {"type": "prometheus", "uid": "Prometheus"}}
      ]
    },
    {
      "type": "logs", "title": "Recent logs (Loki)",
      "gridPos": {"x": 0, "y": 16, "w": 24, "h": 10},
      "options": {"showTime": true, "dedupStrategy": "none", "wrapLogMessage": true},
      "datasource": {"type": "loki", "uid": "Loki"},
      "targets": [
        {"expr": "{service=\"api\"}", "refId": "A"}
      ]
    }
  ]
}
